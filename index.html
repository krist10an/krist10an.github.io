<!DOCTYPE html>
<html lang="en">
<head>

	<title>Kristian's Navigator</title>
	<meta charset="utf-8" />

	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.css" />
	<!--[if lte IE 8]>
	    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.ie.css" />
	<![endif]-->

	<script src="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.js"></script>

	<script src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
	<script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

	<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <style type="text/css">
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>

</head>
<body>

	<div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="#">Map</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="#">Select</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

	<div class="container">
		<h3>Move pins to select your area</h3>
	 	<div id="map" style="height: 480px;"></div>
	 	<div style="padding-top: 40px;">
			<p>Output to Python script:<p>
	 		<pre id="where">&nbsp;</pre>
			<p>Area covered:<p>
	 		<pre id="dist"></pre>
	 	</div>

	</div>
	<script>
		// Basemaps
		var oms_url =  "http://129.206.74.245:8004/tms_hs.ashx?x={x}&y={y}&z={z}"
		var oms_attr = 'Tiles by <a href="http://openmapsurfer.uni-hd.de/">OpenMapSurfer</a>'
		var oms_tile = L.tileLayer(oms_url, { maxZoom: 14,	attribution: oms_attr });

		var osm_url = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'
		var osm_attr = 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'
		var osm_tile = L.tileLayer(osm_url, { maxZoom: 18,	attribution: osm_attr });

		var ts_url = "http://tile.stamen.com/terrain-background/{z}/{x}/{y}.jpg"
		var ts_attr = '<a href="http://maps.stamen.com/">Map tiles</a> by <a href="http://stamen.com/">Samen Design</a>. Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors"'
		var ts_tile = L.tileLayer(ts_url, { maxZoom: 18, attribution: ts_attr });

		var nk_url = "http://opencache.statkart.no/gatekeeper/gk/gk.open_gmaps?layers=topo2&zoom={z}&x={x}&y={y}"
		var nk_attr = 'Map data &copy; Norgeskart'
		var nk_tile = L.tileLayer(nk_url, {	maxZoom: 18, attribution: nk_attr });

		// Overlays
		var opm_url = 'http://tiles2.openpistemap.org/landshaded/{z}/{x}/{y}.png'
		var opm_attr = 'Landshading by <a href="OpenPisteMap.org">OpenPisteMap.org</a>'
		var opm_tile = L.tileLayer(opm_url, { maxZoom: 18, attribution: opm_attr });

		var map = L.map('map', {
			center: new L.LatLng(61.46, 7.87),
			zoom: 7,
			layers: [osm_tile]
		});

		var baseMaps = {
			"OpenStreetMap": osm_tile,
			"ASTER GDEM & STRM Hillshade": oms_tile,
			"Samen Design (US only)" : ts_tile,
			"Norgeskart" : nk_tile,
		};
		var overlayMaps = {
			"Landshading by OpenPisteMap" : opm_tile,
		}
		L.control.layers(baseMaps, overlayMaps).addTo(map);

		L.control.scale().addTo(map);

		var popup = L.popup();

		var myrect = L.rectangle([[61.43056, 7.92252], [61.49780, 7.75806]], {color: "#ff7800", weight:1}).addTo(map);

		var northEastMarker = L.marker(myrect.getBounds().getNorthEast(), { draggable : true }).addTo(map);
		var southWestMarker = L.marker(myrect.getBounds().getSouthWest(), { draggable : true }).addTo(map);

		var digits = 5;

		function onMapDrag(e) {
			var NE = northEastMarker.getLatLng();
			var SW = southWestMarker.getLatLng();

			var dist_NS = NE.distanceTo([SW.lat, NE.lng]).toFixed(0);
			var dist_WE = NE.distanceTo([NE.lat, SW.lng]).toFixed(0);

			myrect.setBounds([[NE.lat, NE.lng], [SW.lat, SW.lng]]);

			var x = NE.lat.toFixed(digits) + ", " +
				 NE.lng.toFixed(digits) + " \n" +
				 SW.lat.toFixed(digits) + ", " +
				 SW.lng.toFixed(digits);
			$("#where").html(x);
			$("#dist").html(dist_NS + " x " + dist_WE + " meters");
		}

		function onMapClick(e) {
			var lat = e.latlng.lat;
			var lng = e.latlng.lng;

			var NE = myrect.getBounds().getNorthEast();
			var SW = myrect.getBounds().getSouthWest();

			var size_NS = NE.lat - SW.lat;
			var size_EW = NE.lng - SW.lng;

			northEastMarker.setLatLng([lat - size_NS/2, lng - size_EW/2]);
			southWestMarker.setLatLng([lat + size_NS/2, lng + size_EW/2]);
			onMapDrag(0);
		}

		northEastMarker.on('drag', onMapDrag);
		southWestMarker.on('drag', onMapDrag);

		northEastMarker.on('dragend', onMapDrag);
		southWestMarker.on('dragend', onMapDrag);

		map.on('click', onMapClick);

		onMapDrag(0);
	</script>

</body>
</html>
